@startuml
!theme plain
hide empty members
skinparam linetype polyline
skinparam shadow false
left to right direction

skinparam class {
    BackgroundColor White
    ArrowColor Black
    BorderColor Black
}

package Model {
  package "Units" <<Rectangle>> {
      interface ElectronicUnit {
        + getFactor(): double
      }

      enum CapacitanceUnit {
        PICO_FARAD
        NANO_FARAD
        MICRO_FARAD
        MILLI_FARAD
      }

      enum DistanceUnit {
        M
        MM
        KM
      }

      enum InductanceUnit {
        HENRY
        MILLI_HENRY
        MICRO_HENRY
        NANO_HENRY
      }

      enum ResistanceUnit {
        OHM
        KILO_OHM
        MEGA_OHM
      }
  }

  class Complex << record >> {
    - real: double
    - imag: double
    + magnitude(): double
    + angle(): double
    + add(Complex): Complex
    + subtract(Complex): Complex
    + multiply(Complex): Complex
    + dividedBy(Complex): Complex
    + toStringmS(): String
  }

  enum StubType {
    OPEN
    SHORT
  }

  enum ElementType {
    CAPACITOR
    INDUCTOR
    RESISTOR
    LINE
  }

  enum ElementPosition {
    SERIES
    PARALLEL
  }

  abstract class CircuitElement {
    # realWorldValue: DoubleProperty
    # elementPosition: ElementPosition
    # elementType: ElementType
    + getImpedance(double): Complex
  }

  class Capacitor {
    + getImpedance(double): Complex
  }

  class Inductor {
    + getImpedance(double): Complex
  }

  class Resistor {
    + getImpedance(double): Complex
  }

  class Line {
    - characteristicImpedance: double
    - permittivity: double
    + calculateImpedance(Complex, double): Complex
  }

  class DataPoint {
    - label: SimpleStringProperty
    - impedance: SimpleObjectProperty<Complex>
    - gamma: SimpleObjectProperty<Complex>
    - vswr: SimpleDoubleProperty
    - returnLoss: SimpleDoubleProperty
  }

  ' Relationships inside Model
  CapacitanceUnit ..|> ElectronicUnit
  DistanceUnit    ..|> ElectronicUnit
  InductanceUnit  ..|> ElectronicUnit
  ResistanceUnit  ..|> ElectronicUnit

  CircuitElement <|-- Capacitor
  CircuitElement <|-- Inductor
  CircuitElement <|-- Resistor
  CircuitElement <|-- Line

  Line --> StubType
  CircuitElement ..> Complex
  CircuitElement --> ElementType
  CircuitElement --> ElementPosition
}

package ViewModel {
  class SmithChartViewModel {
    + frequency: DoubleProperty
    + mouseImpedanceZ: ObjectProperty<Complex>
    + dataPoints: SimpleListProperty<DataPoint>
    + circuitElements: SimpleListProperty<CircuitElement>
    - undoStack: Stack<UndoRedoEntry>
    + undo(): void
    + redo(): void
    + addComponent(...): void
    - recalculateImpedanceChain(): void
  }
}

package View {
  class CircuitRenderer {
    - circuitCanvas: Canvas
    + render(SmithChartViewModel): void
    - drawResistor(...): void
    - drawCapacitor(...): void
    - drawInductor(...): void
  }

  class SmithChartRenderer {
    - smithCanvas: Canvas
    + render(SmithChartViewModel...): void
    - drawSmithGrid(...): void
    - drawImpedancePath(...): void
  }
}

package Controller {
  class SmithController {
    - viewModel: SmithChartViewModel
    + initialize(): void
    + onChangeFreq(ActionEvent): void
    + onAddComponentMouse(ActionEvent): void
    - calculateComponentValue(...): Double?
  }
}

package Infrastructure {
  class DialogFactory {
    + showComplexInputDialog(...): Optional<Complex>
    + showComponentEditDialog(...): Optional<Double>
  }

  class SmithUtilities {
    + gammaToImpedance(...): Complex
    + getArcParameters(...): Pair<Complex, Double>
  }

  class JSmithFXApplication {
    + start(Stage): void
  }

  class Launcher {
    + main(String[]): void
  }
}

' === Main Architecture Relationships ===

' Controller manages ViewModel and View
SmithController o--> SmithChartViewModel
SmithController o--> SmithChartRenderer
SmithController o--> CircuitRenderer

' View renders data from ViewModel
CircuitRenderer ..> SmithChartViewModel : <<reads>>
SmithChartRenderer ..> SmithChartViewModel : <<reads>>

' ViewModel manages Model
SmithChartViewModel o--> "0..*" CircuitElement
SmithChartViewModel *--> "0..*" DataPoint

' Infrastructure helpers
SmithUtilities ..> Complex
DialogFactory ..> CircuitElement
Launcher ..> JSmithFXApplication

@enduml